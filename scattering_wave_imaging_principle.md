# 波数域散射波滤波成像原理

## 1. 核心物理思想

在导波无损检测中，波场信号通常由以下几部分组成：

1. **入射波 (Incident Wave)**: 能量强，波长较长，主要集中在低波数区域。
2. **反射波 (Reflected Wave)**: 遇到边界或大缺陷反射回来的波。
3. **散射波 (Scattered Wave)**: 遇到微小缺陷（如裂纹、腐蚀坑）时产生的向四周扩散的波。

**关键特征**: 由于缺陷通常在几何尺寸上发生突变，根据波的衍射理论，缺陷处的**空间变化率较高**。在波数域（k-space）中，这意味着散射信号往往包含比单一频率入射波**更高或更宽的波数分量**。

因此，通过滤除代表入射波的"低波数"成分，保留"高波数"成分，可以有效地抑制背景信号，显著提高缺陷散射波的信噪比 (SNR)。

## 2. 算法实现流程

程序遵循 "Antigravity" 框架的六阶段处理流程：

### Phase 1: 3D FFT (时空-波数变换)

将采集到的三维波场数据 $u(x, y, t)$ 通过 3D 快速傅里叶变换 (FFT) 转换到 波数-频率域：
$$ U(k_x, k_y, f) = \iiint u(x, y, t) e^{-i(k_x x + k_y y + 2\pi f t)} dx dy dt $$
在此域中，不同的波（具有不同的传播方向和波长）被分离到不同的 $(k_x, k_y)$ 坐标点上。

### Phase 2: 定向滤波器设计

针对 `filter_mode = 'scattered'` (散射波模式)，我们设计了一个**带通滤波器**：

1. **高通部分 (High-pass)**: 抑制入射波。
    $$ M_{high}(k) = 1 - \exp\left(-\frac{|k|^2}{2 k_{cut\_high}^2}\right) $$
    其中 $k = \sqrt{k_x^2 + k_y^2}$。这部分去除了能量集中的低波数主波。

2. **低通部分 (Low-pass)**: 抑制极高频噪声。
    $$ M_{low}(k) = \exp\left(-\frac{(|k| - k_{cut\_low})^2}{2 \sigma^2}\right) $$
    这部分去除了由测量噪声或插值伪影产生的非物理高波数信号。

3. **综合掩码**:
    $$ M_{total}(k) = M_{high}(k) \times M_{low}(k) $$

### Phase 3: 滤波与反变换

在波数域应用掩码：
$$ U_{filtered}(k_x, k_y, f) = U(k_x, k_y, f) \cdot M_{total}(k) $$

然后通过逆 FFT (IFFT) 变回时空域：
$$ u_{filtered}(x, y, t) = \text{Re}\{ \text{IFFT3n}(U_{filtered}) \} $$

此时，$u_{filtered}$ 中仅保留了由缺陷引起的散射能量，背景的主波已被去除。

### Phase 4: RMS 成像

计算每个空间点的均方根 (RMS) 值，形成最终的能量分布图：
$$ I(x, y) = \sqrt{\frac{1}{T} \sum_{t} u_{filtered}(x, y, t)^2} $$

## 3. 为什么这种方法有效？

传统的时域减法（基准信号相减）容易受温度、耦合条件变化的影响。

**波数域滤波的优势**:

1. **无需基准信号**: 直接利用信号本身的空间频率特征（缺陷产生高波数）进行分离。
2. **全场一致性**: 利用了波场在整个扫描区域的连续性，比单点信号处理更鲁棒。
3. **物理意义明确**: 直接对应波的传播物理特性（如波长、方向）。

## 4. 示意图

```mermaid
graph LR
    A[原始波场 u(x,y,t)] -->|3D FFT| B[波数谱 U(kx,ky,f)]
    B --> C{滤波器设计}
    C -->|高通| D[去除低波数入射波]
    C -->|低通| E[去除高频噪声]
    D & E --> F[滤波后谱 U_filt]
    F -->|IFFT & real| G[散射波场 u_filt]
    G -->|RMS计算| H[缺陷成像图]
```
